#! /usr/bin/python3

import requests
import os
from PIL import Image

challenge_url = "http://www.pythonchallenge.com/pc/def/oxygen.html"

# Gets an image
challenge = requests.get(challenge_url)
challenge_image = requests.get(challenge_url[:-4]+"png")

with open("oxygen.png", "wb") as f:
    f.write(challenge_image.content)

im = Image.open("oxygen.png")
width, height = im.size

half_height = height // 2

pixels = []
for i in range(width):
    r, g, b, a = im.getpixel((i, half_height))
    if r == g == b:
        pixels.append(r)

os.remove("oxygen.png")

# Corrections in data
pixels = [115, 115] + pixels
pixels.pop()

chars = []
for i in range(0, len(pixels), 7):
    chars.append(pixels[i])

solution_text = "".join([chr(i) for i in chars])
print(solution_text)

chars = solution_text[solution_text.find("[")+1:-1].split(", ")
solution_text = "".join([chr(int(i)) for i in chars])
print(solution_text)

print(f"Solution URL:", challenge_url[:-11]+solution_text+".html")

